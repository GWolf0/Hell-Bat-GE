var mt=Object.defineProperty;var ft=(d,t,e)=>t in d?mt(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var s=(d,t,e)=>(ft(d,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();class j{static img(t,e,i,r,n,a,c){c.rot=c.rot||0,c.opacity=c.opacity||1,c.fillColor=c.fillColor||"",c.strokeColor=c.strokeColor||"",c.sx=c.sx||0,c.sy=c.sy||0,c.sw=c.sw||a.width,c.sh=c.sh||a.height,t.save(),t.globalAlpha=c.opacity,c.flipHoriz?(t.translate(e+r*.5,i+n*.5),t.scale(-1,1),t.translate(-r*.5,-n*.5)):t.translate(e,i),t.rotate(c.rot),t.drawImage(a,c.sx,c.sy,c.sw,c.sh,c.fillColor?-r*.5:0,c.fillColor?-n*.5:0,r,n),t.restore()}static rect(t,e,i,r,n,a){a.rot=a.rot||0,a.opacity=a.opacity||1,a.fillColor=a.fillColor||"",a.strokeColor=a.strokeColor||"",a.lineWidth=a.lineWidth||1,t.save(),t.lineWidth=a.lineWidth,t.globalAlpha=a.opacity,t.fillStyle=a.fillColor,t.strokeStyle=a.strokeColor,t.translate(e,i),t.rotate(a.rot),a.fillColor&&t.fillRect(0,0,r,n),a.strokeColor&&t.strokeRect(0,0,r,n),t.restore()}static arc(t,e,i,r,n,a=0,c=Math.PI*2){n.rot=n.rot||0,n.opacity=n.opacity||1,n.fillColor=n.fillColor||"",n.strokeColor=n.strokeColor||"",n.lineWidth=n.lineWidth||1,t.save(),t.lineWidth=n.lineWidth,t.globalAlpha=n.opacity,t.fillStyle=n.fillColor,t.strokeStyle=n.strokeColor,t.translate(e,i),t.rotate(n.rot),t.beginPath(),t.arc(0,0,r,a,c),n.fillColor&&t.fill(),n.strokeColor&&t.stroke(),t.closePath(),t.restore()}static line(t,e,i,r,n,a){a.rot=a.rot||0,a.opacity=a.opacity||1,a.fillColor=a.fillColor||"",a.strokeColor=a.strokeColor||"",a.lineWidth=a.lineWidth||1,t.save(),t.lineWidth=a.lineWidth,t.globalAlpha=a.opacity,t.fillStyle=a.fillColor,t.strokeStyle=a.strokeColor,t.beginPath(),t.moveTo(e,i),t.lineTo(r,n),a.fillColor&&t.fill(),a.strokeColor&&t.stroke(),t.closePath(),t.restore()}static dot(t,e,i,r,n){j.arc(t,e,i,r*.5,n)}static text(t,e,i,r,n){n.rot=n.rot||0,n.opacity=n.opacity||1,n.fillColor=n.fillColor||"",n.strokeColor=n.strokeColor||"",n.lineWidth=n.lineWidth||1,n.fontSize=n.fontSize||16,n.textBaseline=n.textBaseline||"middle",n.textAlign=n.textAlign||"start",t.save(),t.lineWidth=n.lineWidth,t.globalAlpha=n.opacity,t.fillStyle=n.fillColor,t.strokeStyle=n.strokeColor,t.font=`${n.fontSize}px Arial`,t.textBaseline=n.textBaseline,t.textAlign=n.textAlign,n.fillColor&&t.fillText(r,e,i),n.strokeColor&&t.strokeText(r,e,i),t.restore()}}const m=class m{static init(t=9/16){m.aspect=t,m.can=document.getElementById("can"),m.container=m.can.parentElement.parentElement,m.resize(),window.addEventListener("resize",()=>m.resize())}static resize(){const t=m.container.getBoundingClientRect();if(m.aspect<=1){const e=t.width,i=e*m.aspect;m.can.width=e,m.can.height=i}else{const e=t.height,i=e/m.aspect;m.can.width=i,m.can.height=e}m.width=m.can.width,m.height=m.can.height}};s(m,"width"),s(m,"height"),s(m,"aspect"),s(m,"container"),s(m,"can");let f=m;const w=class w{static init(){w.can=f.can,w.ctx=w.can.getContext("2d"),w.ctx.imageSmoothingEnabled=!1}static clearScreen(){w.ctx.fillStyle=w.CLEAR_COLOR,w.ctx.fillRect(0,0,f.width,f.height)}static renderSprite(t){if(t.img)if(t.animator&&t.animator.animation){const e=t.animator.animation.frame;j.img(w.ctx,t.t.pos.x,t.t.pos.y,t.t.scl.x,t.t.scl.y,t.img,{sx:e.x,sy:e.y,sw:e.w,sh:e.h,rot:t.t.rot,flipHoriz:t.flipHorizontaly})}else j.img(w.ctx,t.t.pos.x,t.t.pos.y,t.t.scl.x,t.t.scl.y,t.img,{rot:t.t.rot,flipHoriz:t.flipHorizontaly});else j.rect(w.ctx,t.t.pos.x,t.t.pos.y,t.t.scl.x,t.t.scl.y,{fillColor:"#eee"})}static renderCollider(t){j.rect(w.ctx,t.rect.x,t.rect.y,t.rect.w,t.rect.h,{strokeColor:"green",lineWidth:2});for(let e=0;e<t.sidesLines.length;e++){const i=t.sidesLines[e];j.line(w.ctx,i.x1,i.y1,i.x2,i.y2,{strokeColor:"red",lineWidth:2})}}};s(w,"CLEAR_COLOR","#000"),s(w,"renderColliders",!0),s(w,"can"),s(w,"ctx");let y=w;const o=class o{static getImg(t){return o.imgs[t]}static getSnd(t){return o.snds[t]}static getLoadingProgress(){return(o.loadedImgAssetsCount+o.loadedSndAssetsCount)/o.totalAssetsCount}static async init(t,e,i=o.DEFAULT_IMGS_ROOT_DIR,r=o.DEFAULT_SNDS_ROOT_DIR){o.imgsRootDir=i,o.sndsRootDir=r,await o.loadImages(t),await o.loadSounds(e),await new Promise(n=>setTimeout(n,o.additionalWaitTime)),o.loaded=!0,o.onLoaded&&o.onLoaded()}static async loadImages(t){return o.imagesAssetsCount=t.length,o.totalAssetsCount+=o.imagesAssetsCount,o.imagesAssetsCount===0?!0:new Promise((e,i)=>{for(let r=0;r<o.imagesAssetsCount;r++){const n=t[r],a=new Image;a.src=`${o.imgsRootDir}${n}`,a.onerror=()=>{console.log("Error loading asset image "+a.src),i("Error loading asset image "+a.src)},a.onload=()=>{o.loadedImgAssetsCount++;const c=n.split(".")[0];o.imgs[c]=a,o.loadedImgAssetsCount===o.imagesAssetsCount&&e(!0)}}})}static async loadSounds(t){return o.soundsAssetsCount=t.length,o.totalAssetsCount+=o.soundsAssetsCount,o.soundsAssetsCount===0?!0:new Promise((e,i)=>{for(let r=0;r<o.soundsAssetsCount;r++){const n=t[r],a=new Audio;a.src=`${o.sndsRootDir}${n}`,a.onerror=()=>{console.log("Error loading asset sound "+a.src),i("Error loading asset sound "+a.src)},a.onloadeddata=()=>{o.loadedSndAssetsCount++;const c=n.split(".")[0];o.snds[c]=a,o.loadedSndAssetsCount===o.soundsAssetsCount&&e(!0)}}})}};s(o,"DEFAULT_IMGS_ROOT_DIR","./assets/game/imgs/"),s(o,"DEFAULT_SNDS_ROOT_DIR","./assets/game/snds/"),s(o,"imgsRootDir"),s(o,"sndsRootDir"),s(o,"loadedImgAssetsCount",0),s(o,"loadedSndAssetsCount",0),s(o,"totalAssetsCount",0),s(o,"imagesAssetsCount",0),s(o,"imgs",{}),s(o,"soundsAssetsCount",0),s(o,"snds",{}),s(o,"loaded",!1),s(o,"additionalWaitTime",1e3),s(o,"onLoaded",null);let R=o;const S=class S{static init(t=.25,e=.5,i=!1,r=!1){S.musicVolume=t,S.fxVolume=e,S.musicMuted=i,S.fxMuted=r}static playMusic(t,e=!1){S.musicMuted||(t.volume=S.musicVolume,t.loop=e,t.play())}static playFX(t,e=!1){S.fxMuted||(t.volume=S.fxVolume,t.loop=e,t.play())}};s(S,"musicVolume",.25),s(S,"fxVolume",.5),s(S,"musicMuted",!1),s(S,"fxMuted",!1);let T=S;class l{constructor(t,e){s(this,"x");s(this,"y");this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}static from(t){return new l(t.x,t.y)}static zero(){return new l(0,0)}static one(t=1){return new l(1*t,1*t)}static left(){return new l(-1,0)}static top(){return new l(0,-1)}static right(){return new l(1,0)}static down(){return new l(0,1)}static add(t,e){return new l(t.x+e.x,t.y+e.y)}static sub(t,e){return new l(t.x-e.x,t.y-e.y)}static mul(t,e){return new l(t.x*e,t.y*e)}static div(t,e){return new l(t.x/e,t.y/e)}static dot(t,e){return t.x*e.x+t.y*e.y}static len(t){return Math.sqrt(l.dot(t,t))}static dist(t,e){return l.len(l.sub(t,e))}static normal(t){return l.div(t,l.len(t))}static lerp(t,e,i){const r=1-i;return new l(t.x*r+e.x*i,t.y*r+e.y*i)}}class I{constructor(t,e,i,r){s(this,"x1");s(this,"y1");s(this,"x2");s(this,"y2");this.x1=t,this.y1=e,this.x2=i,this.y2=r}static zero(){return new I(0,0,0,0)}static fromV2(t,e){return new I(t.x,t.y,e.x,e.y)}}class H{constructor(t,e,i,r){s(this,"x");s(this,"y");s(this,"w");s(this,"h");this.x=t,this.y=e,this.w=i,this.h=r}static zero(){return new H(0,0,0,0)}static one(t=1){return new H(1*t,1*t,1*t,1*t)}get rect2(){return new H(this.x,this.y,this.x+this.w,this.y+this.h)}set(t,e,i,r){this.x=t,this.y=e,this.w=i,this.h=r}}const h=class h{static init(){window.addEventListener("mousemove",t=>{const e=f.can;if(e){const i=e.getBoundingClientRect();h.mousePos.set(t.clientX-i.left,t.clientY-i.top)}}),window.addEventListener("pointermove",t=>{const e=f.can;if(e){const i=e.getBoundingClientRect();h.mousePos.set(t.clientX-i.left,t.clientY-i.top)}}),window.addEventListener("mousedown",()=>{h.mouseUp=!1,h.mouseDown=!0}),window.addEventListener("mouseup",()=>{h.mouseDown=!1,h.mouseUp=!0}),window.addEventListener("pointerdown",()=>{h.mouseUp=!1,h.mouseDown=!0}),window.addEventListener("pointerup",()=>{h.mouseDown=!1,h.mouseUp=!0}),window.addEventListener("keydown",t=>{const e=t.key;h.keysAliases.includes(e)&&(h.keys[e].isDown=!0,h.keys[e].isUp=!1)}),window.addEventListener("keyup",t=>{const e=t.key;h.keysAliases.includes(e)&&(h.keys[e].isDown=!1,h.keys[e].isUp=!0)})}static preUpdate(){}static lateUpdate(){h.mouseDown=!1,h.mouseUp=!1;for(let t=0;t<h.keysAliases.length;t++){const e=h.keysAliases[t];h.keys[e].isUp=!1}}static isMouseButtonDown(){return h.mouseDown}static isMouseButtonUp(){return h.mouseUp}static isKeyDown(t){return h.keysAliases.includes(t)&&h.keys[t].isDown===!0}static isKeyUp(t){return h.keysAliases.includes(t)&&h.keys[t].isUp===!0}};s(h,"keys",{" ":{},ArrowLeft:{},ArrowUp:{},ArrowRight:{},ArrowDown:{}}),s(h,"keysAliases",Object.keys(h.keys)),s(h,"mouseDown",!1),s(h,"mouseUp",!1),s(h,"mousePos",l.zero());let G=h;function wt(d,t){return Math.floor(Math.random()*(t-d))+d}function pt(d,t){const e=d.rect,i=t.rect,r=e.x<i.x+i.w&&e.x+e.w>i.x,n=e.y<i.y+i.h&&e.y+e.h>i.y;return r&&n}function yt(d,t){const e=t.rect,i=d.sidesLines[0];if(q(i.x1,i.y1,i.x2,i.y2,e))return"left";const r=d.sidesLines[1];if(q(r.x1,r.y1,r.x2,r.y2,e))return"top";const n=d.sidesLines[2];if(q(n.x1,n.y1,n.x2,n.y2,e))return"right";const a=d.sidesLines[3];return q(a.x1,a.y1,a.x2,a.y2,e)?"bottom":"none"}function ct(d,t,e){return d>e.x&&d<e.x+e.w&&t>e.y&&t<e.y+e.h}function q(d,t,e,i,r){return ct(d,t,r)&&ct(e,i,r)}const u=class u{static init(){u.bodies=[],u.collidedPairs=[],u.newCollidedPairs=[]}static addBody(t){u.bodies.push(t)}static removeBody(t){u.bodies.splice(u.bodies.indexOf(t),1)}static update(){u.newCollidedPairs.length=0;for(let t=0;t<u.bodies.length;t++){const e=u.bodies[t];!e.active||!e.collider||(e.updateMovement(),e.type==="rigid"&&u.checkCollisions(e))}for(let t=u.collidedPairs.length-1;t>=0;t--){const e=u.collidedPairs[t];u.isPairInCollection(e,u.newCollidedPairs)||u.collidedPairs.splice(t,1)}}static checkCollisions(t){for(let e=0;e<u.bodies.length;e++){const i=u.bodies[e];if(t.uid!==i.uid&&pt(t.collider,i.collider)){const r=[t,i];u.isPairInCollection(r,u.collidedPairs)||(u.collidedPairs.push(r),t.onCollisionEnter&&t.onCollisionEnter(i)),u.newCollidedPairs.push([t,i]);const n=yt(t.collider,i.collider);i.type!=="trigger"&&t.reactToCollision(n)}}}static isPairInCollection(t,e){return e.findIndex(([i,r],n)=>i.uid===t[0].uid&&r.uid===t[1].uid||i.uid===t[1].uid&&r.uid===t[0].uid)>-1}};s(u,"G",.5),s(u,"bodies"),s(u,"collidedPairs"),s(u,"newCollidedPairs");let N=u;class it{constructor(t,e,i=null){s(this,"id");s(this,"name");s(this,"gameObject");s(this,"active",!0);this.id=t,this.name=e,this.gameObject=i}setGameObject(t){this.gameObject=t,this.onGameObjectChanged()}masterUpdate(){this.active&&this.update()}onGameObjectChanged(){}}const X=class X extends it{constructor(e=l.zero(),i=0,r=l.one(),n=null){super(X.id,"Transform");s(this,"_pos");s(this,"rot");s(this,"scl");s(this,"parent");s(this,"children");this._pos=e,this.rot=i,this.scl=r,this.children=[],this.setParent(n)}get dir(){return new l(Math.cos(this.rot),Math.sin(this.rot))}get pos(){return this.parent?l.add(this._pos,this.parent.pos):this._pos}static default(){return new X}setParent(e){this.parent=e,this.parent&&this.parent.children.push(this)}setFrom(e){this._pos=e._pos,this.rot=e.rot,this.scl=e.scl}update(){}};s(X,"id",0);let z=X;const p=class p{static init(){p.lastTime=new Date().valueOf(),p.elapsed=0}static update(){const t=new Date().valueOf();p.dt=t-p.lastTime,p.dts=p.dt/1e3,p.elapsed+=p.dt,p.lastTime=t,p.fps=Math.floor(1e3/p.dt)}};s(p,"dt"),s(p,"dts"),s(p,"elapsed"),s(p,"lastTime"),s(p,"fps");let k=p;const _=class _ extends it{constructor(e=null){super(_.id,"Animator");s(this,"animation",null);s(this,"timer",0);s(this,"paused",!1);this.setAnimation(e)}setAnimation(e){this.animation=e,this.animation&&(this.animation.reset(),this.timer=0)}update(){this.paused||!this.animation||this.animation.finished||(this.timer+=k.dt,this.timer>this.animation.frameDuration&&(this.timer=0,this.animation.nextFrame()))}pause(){this.paused=!0}resume(){this.paused=!1}};s(_,"id",3);let J=_;const D=class D extends it{constructor(e,i,r=.95,n=1.1){super(D.id,"Body");s(this,"uid");s(this,"type");s(this,"collider");s(this,"acc",l.zero());s(this,"vel",l.zero());s(this,"friction");s(this,"restitution");s(this,"isGrounded",!1);s(this,"gravityScale",1);s(this,"stop",!1);s(this,"onCollisionEnter",null);this.uid=D.UIDs++,this.type=e,this.friction=r,this.restitution=n,this.collider=i}update(){}updateMovement(){!this.gameObject||!this.collider||this.type==="rigid"&&(this.isGrounded||(this.acc.y+=N.G*this.gravityScale),this.acc.y=Math.min(this.acc.y,D.MAX_GRAVITY),this.vel.x+=this.acc.x,this.vel.y+=this.acc.y,this.vel.x*=this.friction,this.vel.y*=this.friction,this.gameObject.t._pos.x+=this.vel.x*k.dts,this.gameObject.t._pos.y+=this.vel.y*k.dts,this.updateCollider(),this.isGrounded=!1)}updateCollider(){this.collider.setFromGameObject(this.gameObject)}setVelocity(e,i,r=!0){r&&this.resetAcceleration(Math.abs(e)>0,Math.abs(i)>0),this.vel.x=e,this.vel.y=i}resetAcceleration(e=!0,i=!0){e&&(this.acc.x=0),i&&(this.acc.y=0)}reactToCollision(e){if(!this.gameObject)return;this.stop=!0;let i=-this.vel.x*this.restitution*k.dts,r=-this.vel.y*this.restitution*k.dts;this.gameObject.t._pos.x+=i,this.gameObject.t._pos.y+=r,this.isGrounded=e==="bottom",this.resetAcceleration(),this.updateCollider()}};s(D,"id",2),s(D,"UIDs",1),s(D,"MAX_GRAVITY",20);let B=D;class gt{constructor(t){s(this,"type");this.type=t}}const b=class b extends gt{constructor(e=l.zero(),i=l.zero(),r=l.zero()){super("box");s(this,"rect");s(this,"sidesLines");s(this,"center");s(this,"offs",l.zero());s(this,"size",l.zero());this.center=e,this.offs=i,this.size=r,this.rect=new H(e.x+i.x,e.y+i.y,r.x,r.y),this.updateSidesLines()}get rect2(){return this.rect.rect2}static fromGameObject(e,i=l.zero(),r=l.zero()){return new b(new l(e.t.pos.x,e.t.pos.y),l.add(new l(0,0),i),l.add(new l(e.t.scl.x,e.t.scl.y),r))}setFromGameObject(e){this.center.set(e.t.pos.x,e.t.pos.y),this.set(this.center.x+this.offs.x,this.center.y+this.offs.y,this.size.x,this.size.y)}set(e,i,r,n){this.rect.set(e,i,r,n),this.updateSidesLines()}updateSidesLines(){this.sidesLines||(this.sidesLines=[I.zero(),I.zero(),I.zero(),I.zero()]),this.sidesLines[0]=new I(this.rect.x,this.rect.y+this.rect.h-this.rect.h*b.CORNERS_MARGIN,this.rect.x,this.rect.y+this.rect.h*b.CORNERS_MARGIN),this.sidesLines[1]=new I(this.rect.x+this.rect.w*b.CORNERS_MARGIN,this.rect.y,this.rect.x+this.rect.w-this.rect.w*b.CORNERS_MARGIN,this.rect.y),this.sidesLines[2]=new I(this.rect.x+this.rect.w,this.rect.y+this.rect.h*b.CORNERS_MARGIN,this.rect.x+this.rect.w,this.rect.y+this.rect.h-this.rect.h*b.CORNERS_MARGIN),this.sidesLines[3]=new I(this.rect.x+this.rect.w*b.CORNERS_MARGIN,this.rect.y+this.rect.h,this.rect.x+this.rect.w-this.rect.w*b.CORNERS_MARGIN,this.rect.y+this.rect.h)}};s(b,"CORNERS_MARGIN",.25);let P=b;const tt=class tt extends it{constructor(e=new P){super(tt.id,"Collider");s(this,"colliderOffs",l.zero());s(this,"colliderExtraSize",l.zero());s(this,"collider");this.collider=e}update(){this.gameObject&&this.collider.setFromGameObject(this.gameObject),y.renderColliders&&y.renderCollider(this.collider)}};s(tt,"id",1);let L=tt;const $=class ${constructor(t){s(this,"uid");s(this,"name");s(this,"comps");this.uid=$.UIDs++,this.name=t;const e=new z;e.setGameObject(this),this.comps=[e,null,null,null]}get t(){return this.comps[z.id]}get collider(){return this.comps[L.id]}get body(){return this.comps[B.id]}get animator(){return this.comps[J.id]}static withBodyAndCollider(t,e,i,r){const n=new $(t);return n.t._pos=e,n.addComponent(r),n.addComponent(new B(i,r.collider)),n}addComponent(t){this.comps[t.id]=t,t.setGameObject(this)}init(){}update(){var t;for(let e=0;e<this.comps.length;e++)(t=this.comps[e])==null||t.masterUpdate()}};s($,"UIDs",1);let F=$;class Ct extends F{constructor(e=z.default()){super("Camera");s(this,"followTarget",null);s(this,"followOffs",l.zero());this.t.setFrom(e)}init(){}update(){this.updateFollowTarget()}updateFollowTarget(){if(!this.followTarget)return;const e=new l(this.followTarget.t.pos.x-f.width*.5,this.followTarget.t.pos.y-f.height*.5);this.t._pos=l.lerp(this.t._pos,e,.1)}setFollowTarget(e,i=l.zero()){this.followTarget=e,this.followOffs=i}}class Y{constructor(t){s(this,"name");s(this,"gameObjects");s(this,"camera");this.name=t,this.gameObjects=[],this.camera=new Ct}init(){var t;for(let e=0;e<this.gameObjects.length;e++){const i=this.gameObjects[e];i.init();for(let r in i.t.children)(t=i.t.children[r].gameObject)==null||t.init()}}addGameObject(t){t.init(),this.gameObjects.push(t),t.body&&N.addBody(t.body);for(let e in t.t.children)this.addGameObject(t.t.children[e].gameObject)}removeGameObject(t){t.body&&N.removeBody(t.body);for(let e in t.t.children)this.removeGameObject(t.t.children[e].gameObject);this.gameObjects.splice(this.gameObjects.indexOf(t),1)}removeGameObjects(t){for(let e=t.length-1;e>=0;e--)t[e]&&this.removeGameObject(t[e])}update(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].update();this.camera.update()}}s(Y,"curScene");const C=class C{static init(t){C.scenes=[],C.uiContainer=document.getElementById(C.UI_CONTAINER_ID),C.uiContainer.style.display="none";for(let e in Array(t).fill(0)){C.scenes.push({});const i=`ui-scene-${e}`,r=document.getElementById(i),n=Array.from(r.querySelectorAll('*[id^="g_"]'));C.scenes[e].container=r;for(let a=0;a<n.length;a++){const c=n[a];C.scenes[e][c.id.substring(2)]=c}}C.showSceneUI(0)}static showSceneUI(t){for(let e=0;e<C.scenes.length;e++){const i=C.scenes[e].container;i.style.display=e===t?"flex":"none"}}};s(C,"UI_CONTAINER_ID","ui-container"),s(C,"uiContainer"),s(C,"scenes");let W=C;class St{constructor(t){s(this,"config");s(this,"scenes",[]);s(this,"curSceneIdx",-1);s(this,"paused",!1);t.aspectRatio=t.aspectRatio||9/16,t.imagesAssetsFileNames=t.imagesAssetsFileNames||[],t.soundsAssetsFileNames=t.soundsAssetsFileNames||[],t.initialSceneIdx=t.initialSceneIdx||0,this.config=t,f.init(t.aspectRatio),W.init(t.scenesCount),y.init(),R.init(t.imagesAssetsFileNames,t.soundsAssetsFileNames),R.onLoaded=()=>{this.setCurScene(t.initialSceneIdx),W.uiContainer.style.display="block"}}get curScene(){return this.curSceneIdx>-1?this.scenes[this.curSceneIdx]:null}get width(){return f.width}get height(){return f.height}init(t){N.init(),this.scenes=t,k.init(),G.init()}setCurScene(t){this.curScene&&this.curScene.removeGameObjects(this.curScene.gameObjects),this.curSceneIdx=t,this.curScene&&this.curScene.init(),W.showSceneUI(t),Y.curScene=this.curScene}run(){this.update(),requestAnimationFrame(()=>this.run())}update(){if(k.update(),!R.loaded)return this.renderLoadingScreen();!this.curScene||this.paused||(N.update(),y.clearScreen(),y.ctx.save(),y.ctx.translate(-this.curScene.camera.t.pos.x,-this.curScene.camera.t.pos.y),this.curScene.update(),y.ctx.restore(),N.update(),G.lateUpdate(),this.config.showFPS&&j.text(y.ctx,10,10,`FPS: ${k.fps}`,{fillColor:"yellow",fontSize:12}))}renderLoadingScreen(){const t=R.getLoadingProgress()*100;y.clearScreen(),y.ctx.save(),j.rect(y.ctx,0,0,this.width,this.height,{fillColor:"#000"}),j.text(y.ctx,this.width*.5,this.height*.5,`loading..(${t}%)`,{fillColor:"#eee",fontSize:16,textBaseline:"middle",textAlign:"center"}),y.ctx.restore()}pause(){this.paused=!0}resume(){this.paused=!1}}class Q extends F{constructor(e,i,r,n="static"){super(e);s(this,"imgName");s(this,"img",null);s(this,"animations",[]);s(this,"flipHorizontaly",!1);this.imgName=r,this.t.setFrom(i),n!=="none"&&(this.addComponent(new L(P.fromGameObject(this))),this.addComponent(new B(n,this.collider.collider))),this.addComponent(new J)}get collider(){return super.collider}get body(){return super.body}get animator(){return super.animator}init(){this.setImage(this.imgName),this.setupAnimations()}setupAnimations(){}update(){super.update(),this.render()}render(){y.renderSprite(this)}setImage(e){this.imgName=e,this.imgName&&(this.img=R.getImg(this.imgName))}}const g=class g extends F{constructor(e,i){super("Spike");s(this,"spawner");s(this,"leftSide");s(this,"rightSide");s(this,"scoreTooken",!1);this.t.setFrom(new z(e)),this.spawner=i,this.leftSide=new Q("spikeLeftSide",new z(new l(-g.spikeWidth-g.spikeOffs,0),0,new l(g.spikeWidth,g.spikeHeight)),"platform","static"),this.rightSide=new Q("spikeRightSide",new z(new l(g.spikeOffs,0),0,new l(g.spikeWidth,g.spikeHeight)),"platform","static"),this.leftSide.t.setParent(this.t),this.rightSide.t.setParent(this.t);const r=P.fromGameObject(this,new l(this.leftSide.t._pos.x+this.leftSide.t.scl.x,-g.spikeHeight),new l(this.rightSide.t._pos.x-(this.leftSide.t._pos.x+this.leftSide.t.scl.x),g.spikeHeight)),n=new L(r),a=new B("trigger",r);this.addComponent(n),this.addComponent(a)}init(){super.init()}update(){this.updateMovement(),super.update()}updateMovement(){this.t._pos.y+=g.speed*this.spawner.diffMul}};s(g,"spikeOffs",100),s(g,"spikeWidth",300),s(g,"spikeHeight",48),s(g,"speed",3);let rt=g;const O=class O extends F{constructor(){super("Spikes Spawner");s(this,"elapsed");s(this,"timer");s(this,"spikes");this.elapsed=0,this.timer=O.spawnInterval,this.spikes=[]}get diffMul(){return Math.min(this.elapsed/O.diffMulStepInterval+1,O.maxDiffMul)}update(){super.update(),this.updateSpawn()}updateSpawn(){this.elapsed+=k.dt,this.timer+=k.dt,this.timer>O.spawnInterval/this.diffMul&&(this.timer=0,this.spawnSpikes())}spawnSpikes(){var r;const e=wt(f.width*.5-O.maxXSpawnPosition,f.width*.5+O.maxXSpawnPosition),i=new rt(new l(e,0),this);this.spikes.push(i),(r=Y.curScene)==null||r.addGameObject(i)}};s(O,"spawnInterval",3e3),s(O,"maxXSpawnPosition",128),s(O,"diffMulStepInterval",3e4),s(O,"maxDiffMul",3.5);let at=O;class Z{constructor(t,e,i=!1){s(this,"frames");s(this,"loop");s(this,"duration");s(this,"frameDuration",0);s(this,"curFrameIdx",0);s(this,"finished",!1);this.frames=t,this.loop=i,this.duration=e,this.frameDuration=this.duration/this.len,this.finished=!1}get len(){return this.frames.length}get frame(){return this.frames[this.curFrameIdx]}static oneFromSpriteSheet(t,e,i,r,n=!1,a){let c=[];for(let v=0;v<i;v++){const K={x:v*t,y:r*e,w:t,h:e};c.push(K)}return new Z(c,a,n)}static manyFromSpriteSheet(t,e,i,r,n,a){let c=[];for(let v=0;v<i;v++){let K=[];for(let nt=0;nt<r[v];nt++){const ut={x:nt*t,y:v*e,w:t,h:e};K.push(ut)}const dt=new Z(K,a[v],n[v]);c.push(dt)}return c}reset(){this.curFrameIdx=0,this.finished=!1}nextFrame(){let t=this.curFrameIdx+1;if(t===this.len)if(this.loop)t=0;else return this.finished=!0,!1;return this.curFrameIdx=t,!0}}const x=class x extends Q{constructor(e=!1){x.initialSpawnPos=new l(f.width*.5-x.BatSize*.5,f.height*.5-x.BatSize*.5);super("Bat",new z(l.from(x.initialSpawnPos),0,new l(x.BatSize,x.BatSize)),"bat","rigid");s(this,"isInHomeScreen");this.isInHomeScreen=e,this.isInHomeScreen||(this.body.onCollisionEnter=i=>{var r,n,a;if(i.type!=="trigger")((r=i.gameObject)!=null&&r.name.startsWith("spike")||((n=i.gameObject)==null?void 0:n.name)==="Bottom Wall")&&M.instance.onGameOver();else if(((a=i.gameObject)==null?void 0:a.name)==="Spike"){const c=i.gameObject;c.scoreTooken||(M.instance.curScene.incrementScore(),T.playFX(R.getSnd("score_notif"))),c.scoreTooken=!0}})}init(){super.init()}setupAnimations(){this.animations=Z.manyFromSpriteSheet(48/3,16/1,1,[3],[!0],[300]),this.animator.setAnimation(this.animations[0])}update(){this.isInHomeScreen||this.updateMovement(),super.update()}updateMovement(){(G.isMouseButtonDown()||G.isKeyUp(" "))&&this.flap()}flap(){const e=(G.mousePos.x-this.t.pos.x)/f.width;this.body.setVelocity(x.xflapForce*e,-x.yflapForce),this.flipHorizontaly=e>0,T.playFX(R.getSnd("coin_jump"))}};s(x,"initialSpawnPos"),s(x,"BatSize",64),s(x,"xflapForce",2e3),s(x,"yflapForce",250);let V=x;class ht extends Q{constructor(){super("bg",new z(l.zero(),0,new l(f.width,f.height)),"bg","none")}init(){super.init()}setupAnimations(){}update(){super.update()}}const A=class A{static init(t,e){A.scene=t,A.uis=W.scenes[e],A.bindListeners()}static bindListeners(){A.uis.retry_btn.onclick=()=>M.instance.onReset()}static setPlayState(){A.uis.score_label.style.visibility="visible",A.uis.retry_btn.style.visibility="hidden"}static setGameOverState(){A.uis.score_label.style.visibility="visible",A.uis.retry_btn.style.visibility="visible"}};s(A,"scene"),s(A,"uis");let U=A;const et=class et extends Y{constructor(){super("Game Scene");s(this,"bg");s(this,"spikeSpawner");s(this,"bat");s(this,"leftWall");s(this,"rightWall");s(this,"bottomWall");s(this,"delayTimer",et.DELAY);s(this,"started",!1);s(this,"score",0)}init(){this.score=0,U.init(this,1),U.setPlayState(),this.bg=new ht,this.spikeSpawner=new at,this.bat=new V,this.leftWall=F.withBodyAndCollider("Left Wall",new l(0,0),"static",new L(new P(l.zero(),new l(0,0),new l(10,f.height)))),this.rightWall=F.withBodyAndCollider("Right Wall",new l(0,0),"static",new L(new P(l.zero(),new l(f.width-10,0),new l(10,f.height)))),this.bottomWall=F.withBodyAndCollider("Bottom Wall",new l(0,0),"static",new L(new P(l.zero(),new l(0,f.height-10),new l(f.width,10)))),this.addGameObject(this.bg),this.addGameObject(this.bat),this.addGameObject(this.spikeSpawner),this.addGameObject(this.leftWall),this.addGameObject(this.rightWall),this.addGameObject(this.bottomWall),super.init()}update(){super.update()}incrementScore(){this.score++,U.uis.score_label.innerText=`SCORE: ${this.score}`}};s(et,"DELAY",500);let lt=et;const E=class E{static init(t,e){E.scene=t,E.uis=W.scenes[e],E.bindListeners()}static bindListeners(){E.uis.play_btn.onclick=()=>E.scene.onPlay()}};s(E,"scene"),s(E,"uis");let ot=E;class xt extends Y{constructor(){super("Home Scene");s(this,"bg");s(this,"bat")}init(){ot.init(this,0),this.bg=new ht,this.bat=new V(!0),this.bat.body.gravityScale=0,this.addGameObject(this.bg),this.addGameObject(this.bat),super.init()}update(){this.checkInputs(),super.update()}checkInputs(){G.isKeyUp(" ")&&this.onPlay()}onPlay(){T.playMusic(R.getSnd("bg_music"),!0),M.instance.setCurScene(1)}}const st=class st extends St{constructor(){super({scenesCount:2,aspectRatio:16/9,showFPS:!0,imagesAssetsFileNames:["bat.png","bg.png","platform.png"],soundsAssetsFileNames:["bg_music.mp3","coin_jump.wav","hit.wav","score_notif.wav"]}),st.instance=this}init(){T.init(.05,.25),super.init([new xt,new lt])}onGameOver(){T.playFX(R.getSnd("hit")),this.pause(),U.setGameOverState()}onReset(){var t,e;(t=this.curScene)==null||t.removeGameObjects(this.curScene.gameObjects),(e=this.curScene)==null||e.init(),this.resume()}};s(st,"instance");let M=st;async function bt(){y.renderColliders=!1;const d=new M;d.init(),d.run()}bt();
